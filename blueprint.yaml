--- !ruby/object:OpenStruct
table:
  :title: Mariadb
  :description: Mariadb Server
  :configuration: !ruby/object:OpenStruct
    table:
      :DEBIAN_FRONTEND: noninteractive
      :root_password: "^^random(32)^^"
      :max_allowed_packet: 4M
      :event_scheduler: 1
      :sql_mode: '1'
      :local_infile: 1
      :innodb_buffer_pool_size: 134217728
    modifiable: true
  :persistent:
  - !ruby/object:OpenStruct
    table:
      :type: dir
      :destination: "/var/lib/mariadb/"
      :source: "/var/lib/containers/^^identifier^^/data"
    modifiable: true
  - !ruby/object:OpenStruct
    table:
      :type: file
      :destination: "/var/log/mariadb.log"
      :source: "/var/lib/containers/^^identifier^^/mariadb.log"
    modifiable: true
  :os_packages:
  - !ruby/object:OpenStruct
    table:
      :type: debian
      :name: default-mysql-server
    modifiable: true
  :images:
  - !ruby/object:OpenStruct
    table:
      :type: lxd
      :image: images/debian/buster/cloud
    modifiable: true
  :containers:
  - !ruby/object:OpenStruct
    table:
      :type: lxd
    modifiable: true
  :binding_anchor: !ruby/object:OpenStruct
    table:
      :variables: !ruby/object:OpenStruct
        table:
          :databasename: "^^identifier^^"
          :username: "^^identifier^^_user"
          :password: "^^random(10)^^"
          :collation: utf8_general_ci
          :charset: utf8
          :super_user: false
          ! ':grant:': false
        modifiable: true
      :strategies: !ruby/object:OpenStruct
        table:
          :addition: !ruby/object:OpenStruct
            table:
              :type: container_script
              :path: "/usr/local/bin/create_db_and_user.sh"
              :required:
              - databasename
              - username
              - password
            modifiable: true
          :accepted:
          - databasename
          - username
          - password
          - collation
          - charset
          - super_user
          - grant
        modifiable: true
      :deletion: !ruby/object:OpenStruct
        table:
          :type: container_script
          :path: "/usr/local/bin/delete_db_and_user.sh"
          :required: !ruby/object:OpenStruct
            table:
              :complete:
              - databasename
              - username
              :user:
              - username
            modifiable: true
          :accepted:
          - databasename
          - username
        modifiable: true
    modifiable: true
  :modification: !ruby/object:OpenStruct
    table:
      :type: container_script
      :path: "/usr/local/bin/update_db_and_user.sh"
      :protected:
      - databasename
      - username
      :accepted: !ruby/object:OpenStruct
        table:
          :update_password:
          - username
          - password
          :super_user:
          - username
          - super_user
          :grant:
          - databasename
          - username
          - grant
        modifiable: true
      :required: !ruby/object:OpenStruct
        table:
          :update_password:
          - username
          - password
          :super_user:
          - username
          - super_user
          :grant:
          - databasename
          - username
          - grant
        modifiable: true
    modifiable: true
  :identifier: mariadb
  :descriptor: !ruby/object:OpenStruct
    table:
      :repository: https://github.com/v2Blueprints/mariadb.git
      :identifier: mariadb
      :branch: main
    modifiable: true
modifiable: true
